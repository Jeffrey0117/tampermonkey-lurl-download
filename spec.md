# Lurl å½±ç‰‡å­˜æª”ç³»çµ± - æŠ€è¡“è¦æ ¼ v2

## æ¦‚è¿°

ä¸€å€‹ã€Œçœ¾äººæ‹¾æŸ´ã€çš„å½±ç‰‡å­˜æª”ç³»çµ±ï¼š
- æ¯å€‹ä½¿ç”¨ Tampermonkey è…³æœ¬çš„äººéƒ½åœ¨å¹«å¿™æ”¶é›†è³‡æ–™
- æ”¶é›†åˆ°çš„è³‡æ–™è®“æ‰€æœ‰äººå—ç›Š
- å½±ç‰‡éæœŸçš„å•é¡Œè¢«è§£æ±º

## ç³»çµ±æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tampermonkey   â”‚  HTTP   â”‚        Lurl API (cloudpipe)     â”‚
â”‚     è…³æœ¬        â”‚ â”€â”€â”€â”€â”€â”€â–º â”‚  epi.isnowfriend.com/lurl       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  POST   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                             â–¼                             â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚   è³‡æ–™åº«     â”‚            â”‚  å‚™ä»½è³‡æ–™å¤¾  â”‚            â”‚   å‰ç«¯é¢æ¿   â”‚
      â”‚ records.jsonlâ”‚            â”‚ /videos      â”‚            â”‚  å±•ç¤º + ç®¡ç† â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ /images      â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åŠŸèƒ½æ¸…å–®

### Phase 1ï¼šè³‡æ–™æ”¶é›† âœ… å·²å®Œæˆ
- [x] POST /lurl/capture - æ¥æ”¶è³‡æ–™
- [x] å­˜åˆ° records.jsonl
- [x] ä¸‹è¼‰å‚™ä»½åˆ° videos/ æˆ– images/
- [x] Tampermonkey è…³æœ¬è‡ªå‹•å›å ±

### Phase 2ï¼šç®¡ç†é¢æ¿
- [ ] GET /lurl/admin - ç®¡ç†å“¡é¢æ¿é é¢
- [ ] GET /lurl/api/records - å–å¾—æ‰€æœ‰è¨˜éŒ„ï¼ˆJSONï¼‰
- [ ] GET /lurl/api/stats - çµ±è¨ˆè³‡æ–™ï¼ˆç¸½æ•¸ã€äººæ°£æ’è¡Œï¼‰
- [ ] DELETE /lurl/api/records/:id - åˆªé™¤è¨˜éŒ„

### Phase 3ï¼šå…§å®¹å±•ç¤º
- [ ] GET /lurl/browse - å…¬é–‹ç€è¦½é é¢ï¼ˆé¡ä¼¼å½±ç‰‡ç«™ï¼‰
- [ ] GET /lurl/video/:id - å–®ä¸€å½±ç‰‡é é¢
- [ ] GET /lurl/files/videos/:filename - æä¾›å½±ç‰‡æª”æ¡ˆ
- [ ] GET /lurl/files/images/:filename - æä¾›åœ–ç‰‡æª”æ¡ˆ

### Phase 4ï¼šå½±ç‰‡å¾©æ´»ï¼ˆæœªä¾†ï¼‰
- [ ] è…³æœ¬æŸ¥è©¢ APIï¼šé€™å€‹ pageUrl æœ‰æ²’æœ‰å‚™ä»½ï¼Ÿ
- [ ] æœ‰å‚™ä»½ â†’ ç›´æ¥æ¸²æŸ“å‚™ä»½å½±ç‰‡
- [ ] æ²’å‚™ä»½ â†’ èµ°åŸæœ¬æµç¨‹

---

## API ç«¯é»è¨­è¨ˆ

### Phase 1ï¼ˆå·²å®Œæˆï¼‰

```
POST /lurl/capture
Body: { title, pageUrl, fileUrl, type }
Response: { ok: true }
```

```
GET /lurl/health
Response: { status: "ok", timestamp: "..." }
```

### Phase 2ï¼šç®¡ç†é¢æ¿

```
GET /lurl/admin
Response: HTML ç®¡ç†é é¢
```

```
GET /lurl/api/records
Query: ?page=1&limit=20&type=video
Response: {
  records: [...],
  total: 100,
  page: 1,
  totalPages: 5
}
```

```
GET /lurl/api/stats
Response: {
  total: 100,
  videos: 80,
  images: 20,
  topUrls: [
    { pageUrl: "...", count: 5 },
    ...
  ]
}
```

### Phase 3ï¼šå…§å®¹å±•ç¤º

```
GET /lurl/browse
Query: ?page=1&type=video
Response: HTML ç€è¦½é é¢ï¼ˆå¡ç‰‡å¼å±•ç¤ºï¼‰
```

```
GET /lurl/files/videos/:filename
Response: å½±ç‰‡æª”æ¡ˆï¼ˆvideo/mp4ï¼‰
```

```
GET /lurl/files/images/:filename
Response: åœ–ç‰‡æª”æ¡ˆï¼ˆimage/jpegï¼‰
```

---

## è³‡æ–™çµæ§‹

### records.jsonlï¼ˆæ¯è¡Œä¸€ç­†ï¼‰

```json
{
  "id": "abc123",
  "title": "Dcard æ–‡ç« æ¨™é¡Œ",
  "pageUrl": "https://lurl.cc/xxx",
  "fileUrl": "https://xxx.com/video.mp4",
  "type": "video",
  "source": "lurl",
  "capturedAt": "2026-01-16T12:00:00Z",
  "backupPath": "videos/Dcardæ–‡ç« æ¨™é¡Œ.mp4",
  "accessCount": 5
}
```

---

## æª”æ¡ˆçµæ§‹

```
cloudpipe/
â”œâ”€â”€ services/
â”‚   â””â”€â”€ lurl.js              # ä¸»è¦ API æœå‹™
â”œâ”€â”€ data/
â”‚   â””â”€â”€ lurl/
â”‚       â”œâ”€â”€ records.jsonl    # è³‡æ–™è¨˜éŒ„
â”‚       â”œâ”€â”€ videos/          # å½±ç‰‡å‚™ä»½
â”‚       â””â”€â”€ images/          # åœ–ç‰‡å‚™ä»½
```

```
lurl-download-userscript/
â”œâ”€â”€ lurlDownloader.user.js   # Tampermonkey è…³æœ¬
â”œâ”€â”€ server/
â”‚   â””â”€â”€ lurl.js              # cloudpipe æœå‹™åŸå§‹ç¢¼
â”œâ”€â”€ SPEC.md                  # æœ¬æ–‡ä»¶
â””â”€â”€ feat.md                  # éœ€æ±‚è¨è«–
```

---

## é–‹ç™¼é †åº

| Phase | ä»»å‹™ | ç‹€æ…‹ |
|-------|------|------|
| 1 | è³‡æ–™æ”¶é›† API | âœ… å®Œæˆ |
| 1 | Tampermonkey è…³æœ¬æ•´åˆ | âœ… å®Œæˆ |
| 1 | cloudpipe éƒ¨ç½² | âœ… å®Œæˆ |
| 2 | ç®¡ç†é¢æ¿ API | ğŸ”² å¾…åš |
| 2 | ç®¡ç†é¢æ¿ UI | ğŸ”² å¾…åš |
| 3 | ç€è¦½é é¢ API | ğŸ”² å¾…åš |
| 3 | ç€è¦½é é¢ UI | ğŸ”² å¾…åš |
| 4 | å½±ç‰‡å¾©æ´»æ©Ÿåˆ¶ | ğŸ”² æœªä¾† |

---

## æŠ€è¡“é¸æ“‡

- **éƒ¨ç½²ï¼š** cloudpipeï¼ˆä¸€å€‹ .js = ä¸€å€‹ APIï¼‰
- **å­˜å„²ï¼š** .jsonlï¼ˆç°¡å–®ã€å¯è¿½åŠ ï¼‰
- **å‰ç«¯ï¼š** å…§åµŒ HTMLï¼ˆä¸ç”¨é¡å¤–æ¡†æ¶ï¼‰
- **æ¨£å¼ï¼š** ç°¡æ½”ã€éŸ¿æ‡‰å¼
