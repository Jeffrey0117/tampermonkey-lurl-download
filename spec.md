# Lurl Archive - 產品規格 v2.0

## 產品定位

**眾包影片存檔服務** - 使用者安裝 Tampermonkey 腳本後，瀏覽 lurl.cc/myppt.cc 時自動備份影片到雲端，並可在 Lurl Archive 網站觀看所有備份內容。

### 核心價值
- lurl.cc 影片 24 小時後失效，我們永久保存
- CDN 有防盜連，只有裝腳本的人能貢獻（技術門檻 = 護城河）
- 越多人用，資料庫越完整 = 網路效應

---

## 商業模式

### 會員制度

| 等級 | 價格 | 權限 |
|------|------|------|
| 訪客 | 免費 | 瀏覽首頁 5 支預覽影片、看標題列表（模糊縮圖，無法播放） |
| 免費會員 | 免費註冊 | 每日觀看 3 支影片、搜尋功能 |
| 貢獻者 | 免費 | 安裝腳本並貢獻 10+ 影片後升級，無限觀看 |
| VIP | $99/月 | 無限觀看、無廣告、優先載入、下載功能、API 存取 |

### 收入來源
1. **VIP 訂閱** - 主要收入
2. **廣告** - 免費用戶觀看前插入廣告（5 秒倒數）
3. **腳本內廣告** - 上傳完成後偶爾顯示贊助提示

### 腳本廣告規劃

```
上傳成功 Toast：
┌──────────────────────────────┐
│ ✅ 已備份到 Lurl Archive     │
│ 💎 升級 VIP 享無限觀看       │
└──────────────────────────────┘

頻率：每 10 次上傳顯示 1 次
VIP 用戶：完全不顯示
```

---

## 系統架構

### 目前 (MVP)
```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ Userscript  │────▶│  Cloudpipe  │────▶│  Local FS   │
│ (瀏覽器)    │     │  (Node.js)  │     │  (影片檔)   │
└─────────────┘     └─────────────┘     └─────────────┘
```

### 未來 (Production)
```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ Userscript  │────▶│   API       │────▶│  R2/S3      │
│ (瀏覽器)    │     │  (Hono/CF)  │     │  (物件儲存) │
└─────────────┘     └─────────────┘     └─────────────┘
                           │
                    ┌──────┴──────┐
                    │   D1/Turso  │
                    │  (資料庫)   │
                    └─────────────┘
```

---

## 功能規格

### 1. 首頁 Landing (/)
- Hero 區塊：介紹服務 + 安裝腳本 CTA
- 精選影片：5 支可播放的預覽影片（吸引註冊）
- 最新上架：標題列表（需登入才能看內容）
- 統計數字：總影片數、今日新增、貢獻者人數

### 2. 瀏覽頁 (/browse)
- **搜尋欄**：支援 ID、標題、URL 片段搜尋
- **篩選**：全部 / 影片 / 圖片
- **排序**：最新 / 最舊
- **卡片網格**：
  - 縮圖 placeholder（lazy load）
  - 標題（2 行截斷）
  - ID 標籤（可點擊複製）
  - 上架時間
- **分頁**：每頁 20 筆，無限滾動

### 3. 觀看頁 (/view/:id)
- 影片播放器（支援 Range 請求）
- 影片資訊：標題、來源、時間、檔案大小
- 原始連結（資訊顯示，非按鈕）
- CDN URL（資訊顯示）
- 下載按鈕（VIP only / 貢獻者）
- Dcard 文章連結（如有）

### 4. 搜尋 API
```
GET /api/records?q=關鍵字&type=video&page=1&limit=20

搜尋範圍：
- id: 精確或部分比對 (如 "mkhev")
- title: 模糊比對 (如 "西斯")
- pageUrl: 包含比對 (如 "n41Xm")
```

---

## UI 設計

### 配色
- 背景：#0f0f0f (深黑)
- 卡片：#1a1a1a
- 強調：#3b82f6 (藍)
- 文字：#ffffff / #888888

### 佈局
```
┌──────────────────────────────────────────────────────┐
│  🎬 Lurl Archive          [🔍 搜尋...]        [登入] │
├──────────────────────────────────────────────────────┤
│ [全部] [影片] [圖片]                       排序: 最新 │
├──────────────────────────────────────────────────────┤
│ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ │
│ │ ▶ 縮圖   │ │ ▶ 縮圖   │ │ ▶ 縮圖   │ │ ▶ 縮圖   │ │
│ ├──────────┤ ├──────────┤ ├──────────┤ ├──────────┤ │
│ │ 標題...  │ │ 標題...  │ │ 標題...  │ │ 標題...  │ │
│ │ #mkhev   │ │ #abc123  │ │ #xyz789  │ │ #def456  │ │
│ └──────────┘ └──────────┘ └──────────┘ └──────────┘ │
│                                                      │
│                   [載入更多...]                      │
└──────────────────────────────────────────────────────┘
```

---

## 實作計畫

### Sprint 1: 效能與搜尋 ✅ 完成
- [x] 修復舊記錄 backupPath 問題
- [x] P0: Browse 頁面效能優化（移除 video preload）
- [x] P1: 新增搜尋欄位（前端即時過濾）
- [x] P2: API 支援 q 參數搜尋
- [x] P3: 卡片顯示 ID 標籤（可複製）
- [x] Commit & Push

### Sprint 2: UI 改版 ✅ 完成
- [x] 重新設計 browse 頁面樣式
- [x] 重新設計 view 頁面
- [x] 新增首頁 landing page
- [x] RWD 響應式設計

### Sprint 3: 基礎會員 ✅ 完成
- [x] 簡易登入系統 (token-based)
- [x] 貢獻者追蹤（腳本帶 token）
- [x] 觀看限制邏輯

### Sprint 4: 商業化 ✅ 完成
- [x] 付款整合 (Stripe mock mode)
- [x] 廣告系統 (5秒倒數廣告)
- [x] 腳本內提示 (每10次上傳顯示VIP提示)

---

## 資料結構

### Record
```json
{
  "id": "mkhevwfs",
  "title": "影片標題",
  "pageUrl": "https://lurl.cc/n41Xm",
  "fileUrl": "https://cdn.../video.mov",
  "type": "video",
  "source": "lurl",
  "capturedAt": "2026-01-16T21:49:44.824Z",
  "backupPath": "videos/untitled_mkhevwfs.mov",
  "ref": "https://dcard.tw/...",
  "size": 103790000,
  "contributorId": "user_xxx"
}
```

### User (Phase 3)
```json
{
  "id": "user_xxx",
  "email": "user@example.com",
  "tier": "contributor",
  "contributions": 42,
  "dailyViews": 0,
  "createdAt": "...",
  "lastLoginAt": "..."
}
```

---

## 檔案結構

```
lurl-download-userscript/
├── lurlDownloader.user.js   # Tampermonkey 腳本
├── server/
│   └── lurl.js              # cloudpipe 服務原始碼
├── SPEC.md                  # 本文件
└── index.html               # Landing page (未來)

cloudpipe/
├── services/
│   └── lurl.js              # 部署的 API 服務
└── data/
    └── lurl/
        ├── records.jsonl    # 資料記錄
        ├── videos/          # 影片備份
        └── images/          # 圖片備份
```

---

## 開始 Sprint 1

目標：Browse 頁面效能優化 + 搜尋功能 + ID 標籤
